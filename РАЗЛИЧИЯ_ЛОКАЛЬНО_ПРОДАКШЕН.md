# –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å—Ä–µ–¥–æ–π

## üîÑ –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
- **–ë–î:** SQLite (`sqlite:///./calendar.db`)
- **Redis:** –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ)
- **Celery:** –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏)
- **Backend:** `uvicorn app.main:app --reload` (dev —Ä–µ–∂–∏–º)
- **Frontend:** `npm run dev` (hot reload)

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω:
- **–ë–î:** PostgreSQL (`postgresql://user:pass@localhost/planner_db`)
- **Redis:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–±—Ä–æ–∫–µ—Ä –¥–ª—è Celery, –∫–µ—à, rate limiting)
- **Celery:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- **Backend:** Systemd service —Å 2 workers
- **Frontend:** Next.js production build

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis + Celery:

### Redis –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
1. **Celery Broker** - –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (`redis://localhost:6379/0`)
2. **Celery Result Backend** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–∞—á (`redis://localhost:6379/0`)
3. **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (`redis://localhost:6379/2`)
4. **–ö–µ—à** (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ) - (`redis://localhost:6379/1`)

### Celery –∑–∞–¥–∞—á–∏:
- ‚úÖ `create_notification_task` - —Å–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ `notify_event_invited_task` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏
- ‚úÖ `notify_event_updated_task` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- ‚úÖ `notify_event_cancelled_task` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ
- ‚úÖ `notify_participant_response_task` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–≤–µ—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- ‚úÖ `send_scheduled_reminders_task` - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (Celery Beat)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Celery:
- `worker_prefetch_multiplier=1` - —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á
- `worker_max_tasks_per_child=500` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫
- `worker_max_memory_per_child=200MB` - –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —É—Ç–µ—á–∫–∞—Ö
- `task_retry_backoff=True` - —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–∞—Ö
- `task_max_retries=5` - –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã:

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis (Windows):

**–í–∞—Ä–∏–∞–Ω—Ç A: WSL2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# –í WSL2
sudo apt update
sudo apt install redis-server
sudo service redis-server start
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Docker**
```bash
docker run -d -p 6379:6379 redis:latest
```

**–í–∞—Ä–∏–∞–Ω—Ç C: Windows –≤–µ—Ä—Å–∏—è**
- –°–∫–∞—á–∞—Ç—å —Å https://github.com/microsoftarchive/redis/releases
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Memurai (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è)

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery worker –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
cd backend
.venv\Scripts\Activate.ps1

# –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
celery -A app.celery_app worker --loglevel=info

# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å—Ç–∏—Ç—å beat (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏)
celery -A app.celery_app beat --loglevel=info
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
# backend/.env

# SQLite –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
DATABASE_URL=sqlite:///./calendar.db

# Redis (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ)
REDIS_URL=redis://localhost:6379/0
REDIS_CACHE_URL=redis://localhost:6379/1
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# –ò–ª–∏ –±–µ–∑ Redis (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏)
# REDIS_URL=memory://
# CELERY_BROKER_URL=memory://
# CELERY_RESULT_BACKEND=memory://
```

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –õ–æ–∫–∞–ª—å–Ω–æ –Ω–µ—Ç Redis
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis –ª–æ–∫–∞–ª—å–Ω–æ (—Å–º. –≤—ã—à–µ)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –†–∞–∑–Ω—ã–µ –ë–î (SQLite vs PostgreSQL)
**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker Compose –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å—Ä–µ–¥—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Celery –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:**
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å Celery worker –ª–æ–∫–∞–ª—å–Ω–æ

---

## üê≥ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–°–æ–∑–¥–∞—Ç—å `docker-compose.yml`:

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: planner_user
      POSTGRES_PASSWORD: planner_pass
      POSTGRES_DB: planner_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

–ó–∞–ø—É—Å–∫:
```bash
docker-compose up -d
```

–¢–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ –±—É–¥–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω!

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- [ ] Redis –∑–∞–ø—É—â–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏)
- [ ] Celery worker –∑–∞–ø—É—â–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏)
- [ ] Celery beat –∑–∞–ø—É—â–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏)
- [ ] `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ë–î –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (`alembic upgrade head`)
- [ ] Backend –∑–∞–ø—É—â–µ–Ω (`uvicorn app.main:app --reload`)
- [ ] Frontend –∑–∞–ø—É—â–µ–Ω (`npm run dev`)

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis:
```bash
redis-cli ping
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: PONG
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Celery:
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º venv
celery -A app.celery_app inspect active
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
```bash
# SQLite
sqlite3 calendar.db ".tables"

# PostgreSQL
psql -U planner_user -d planner_db -c "\dt"
```


