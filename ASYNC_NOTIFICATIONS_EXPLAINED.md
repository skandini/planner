# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üìö –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

### –ß—Ç–æ —Ç–∞–∫–æ–µ BackgroundTasks?

`BackgroundTasks` –≤ FastAPI - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á **–ø–æ—Å–ª–µ** –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É. –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

1. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞** - –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç
2. **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å** - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É
3. **–í —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞/–≤–æ—Ä–∫–µ—Ä–∞
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –Ω–µ –Ω—É–∂–µ–Ω Redis/Celery –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á

---

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### ‚ùå –ë–´–õ–û (–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ):

```python
def create_event(...):
    # –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
    event = Event(...)
    session.add(event)
    session.commit()
    
    # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –°–ò–ù–•–†–û–ù–ù–û (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å)
    for participant_id in participant_ids:
        notify_event_invited(
            session=session,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ —Å–µ—Å—Å–∏—é
            user_id=participant_id,
            event=event,
        )
    
    # –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –í–°–ï–• —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç
    return serialized_event
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚è±Ô∏è –ö–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç –ø–æ–∫–∞ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- üêå –ï—Å–ª–∏ 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ = 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
- ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ - –ø–∞–¥–∞–µ—Ç –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å
- üìä –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: ~200-500ms

---

### ‚úÖ –°–¢–ê–õ–û (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ):

```python
def create_event(..., background_tasks: BackgroundTasks):
    # –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
    event = Event(...)
    session.add(event)
    session.commit()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å (–ù–ï –≤—ã–ø–æ–ª–Ω—è–µ–º —Å—Ä–∞–∑—É!)
    for participant_id in participant_ids:
        background_tasks.add_task(
            notify_event_invited_async,  # –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ü–û–°–õ–ï –æ—Ç–≤–µ—Ç–∞
            user_id=participant_id,
            event_id=event.id,
        )
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –°–†–ê–ó–£ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã!)
    return serialized_event
    # ‚Üë –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ FastAPI –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ background_tasks
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É (~50-100ms)
- üöÄ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ
- ‚úÖ –û—à–∏–±–∫–∞ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
- üìä –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: ~50-100ms

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: Endpoint –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

```python
@router.post("/", response_model=EventRead)
def create_event(
    payload: EventCreate,
    background_tasks: BackgroundTasks,  # ‚Üê FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ç
    session: SessionDep,
    current_user: User = Depends(get_current_user),
) -> EventRead:
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `BackgroundTasks`
- –≠—Ç–æ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞

---

### –®–∞–≥ 2: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

```python
    # –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
    event = Event(**data)
    session.add(event)
    session.flush()
    
    # –î–æ–±–∞–≤–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    if participant_ids:
        _attach_participants(session, event.id, participant_ids)
    
    session.commit()  # ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    session.refresh(event)
```

**–í–∞–∂–Ω–æ:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î.

---

### –®–∞–≥ 3: –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å

```python
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å (–ù–ï –≤—ã–ø–æ–ª–Ω—è–µ–º!)
    if participant_ids:
        inviter_name = current_user.full_name or current_user.email
        for participant_id in participant_ids:
            if participant_id != current_user.id:
                background_tasks.add_task(  # ‚Üê –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
                    notify_event_invited_async,  # –§—É–Ω–∫—Ü–∏—è
                    user_id=participant_id,      # –ê—Ä–≥—É–º–µ–Ω—Ç—ã
                    event_id=event.id,
                    inviter_name=inviter_name,
                )
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `add_task()` **–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç** —Ñ—É–Ω–∫—Ü–∏—é —Å—Ä–∞–∑—É
- –û–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã **–ø–æ—Å–ª–µ** –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É

---

### –®–∞–≥ 4: –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É

```python
    serialized_event = _serialize_event_with_participants(session, event)
    return serialized_event  # ‚Üê –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –°–†–ê–ó–£
```

**–í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç:**
- ‚úÖ –ö–ª–∏–µ–Ω—Ç —É–∂–µ –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç (HTTP 201)
- ‚è≥ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—â–µ –ù–ï —Å–æ–∑–¥–∞–Ω—ã
- üìã FastAPI –¥–µ—Ä–∂–∏—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á

---

### –®–∞–≥ 5: FastAPI –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

**–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É:**

```python
# FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ background_tasks
for task in background_tasks.tasks:
    task()  # –í—ã–ø–æ–ª–Ω—è–µ—Ç notify_event_invited_async()
```

**–ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:**

```python
def notify_event_invited_async(user_id, event_id, inviter_name):
    # –°–æ–∑–¥–∞–µ–º –ù–û–í–£–Æ —Å–µ—Å—Å–∏—é –ë–î (–≤–∞–∂–Ω–æ!)
    with Session(engine) as session:
        # –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
        event = session.get(Event, event_id)
        
        # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        notification = Notification(
            user_id=user_id,
            event_id=event_id,
            type="event_invited",
            title="–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É",
            message=f"–í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É ¬´{event.title}¬ª",
        )
        session.add(notification)
        session.commit()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

**–í–∞–∂–Ω–æ:**
- –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç **—Å–≤–æ—é —Å–µ—Å—Å–∏—é –ë–î**
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ

---

## üìä –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–ë–´–õ–û):

```
–ó–∞–ø—Ä–æ—Å ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 1 ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 2 ‚Üí ... ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ N ‚Üí –û—Ç–≤–µ—Ç
         [50ms]            [20ms]          [20ms]          [20ms]    [20ms]        [200ms]
                                                                                    ‚Üë
                                                                              –ö–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~350ms (–∫–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç –≤—Å–µ)

---

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–°–¢–ê–õ–û):

```
–ó–∞–ø—Ä–æ—Å ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è ‚Üí –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É ‚Üí [–§–æ–Ω: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è]
         [50ms]            [50ms]            [20ms √ó N –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ]
         ‚Üë                                    ‚Üë
    –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç              –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
```

**–í—Ä–µ–º—è –¥–æ –æ—Ç–≤–µ—Ç–∞:** ~100ms (–∫–ª–∏–µ–Ω—Ç –Ω–µ –∂–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### 1. –ü–æ—á–µ–º—É –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ë–î?

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –∏–∑ endpoint
def notify_async(session):  # session —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ—Å–ª–µ commit!
    notification = Notification(...)
    session.add(notification)  # –û–®–ò–ë–ö–ê: —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
def notify_async(user_id, event_id):
    with Session(engine) as session:  # –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è
        notification = Notification(...)
        session.add(notification)
        session.commit()
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –°–µ—Å—Å–∏—è –∏–∑ endpoint –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `commit()`
- –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ–∑–∂–µ
- –ù—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏

---

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
def notify_event_invited_async(...):
    try:
        # –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        ...
    except Exception as e:
        logger.error(f"Error in notify_event_invited_async: {e}", exc_info=True)
        # –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –ù–ï –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- –û—à–∏–±–∫–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

---

### 3. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–í–∞–∂–Ω–æ:** –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** (–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)

```python
background_tasks.add_task(task1)  # –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–µ—Ä–≤–æ–π
background_tasks.add_task(task2)  # –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤—Ç–æ—Ä–æ–π
background_tasks.add_task(task3)  # –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç—Ä–µ—Ç—å–µ–π
```

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Celery –∏–ª–∏ asyncio.

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–º–µ—Ä: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

**–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:**
- –í—Ä–µ–º—è –¥–æ –æ—Ç–≤–µ—Ç–∞: ~250ms (10 √ó 20ms –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- –ö–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç: ‚úÖ –î–∞

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:**
- –í—Ä–µ–º—è –¥–æ –æ—Ç–≤–µ—Ç–∞: ~100ms (—Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- –ö–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç: ‚ùå –ù–µ—Ç
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è: –í —Ñ–æ–Ω–µ (~200ms –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)

**–£–ª—É—á—à–µ–Ω–∏–µ:** –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–Ω–∏–∂–µ–Ω–æ –Ω–∞ **60%** (250ms ‚Üí 100ms)

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BackgroundTasks

### ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û—Ç–ø—Ä–∞–≤–∫–∞ email (–µ—Å–ª–∏ –±—ã—Å—Ç—Ä–∞—è)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
- –ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (< 1 —Å–µ–∫—É–Ω–¥—ã)

### ‚ùå –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –î–æ–ª–≥–∏–µ –∑–∞–¥–∞—á–∏ (> 5 —Å–µ–∫—É–Ω–¥) - –Ω—É–∂–µ–Ω Celery
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ - –ª—É—á—à–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ó–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è - –Ω—É–∂–Ω–∞ –æ—á–µ—Ä–µ–¥—å (Redis/RabbitMQ)

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –∫–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

```python
# backend/app/api/v1/events.py:821-831
# Create notifications for participants (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ BackgroundTasks)
if participant_ids:
    inviter_name = current_user.full_name or current_user.email
    for participant_id in participant_ids:
        if participant_id != current_user.id:
            background_tasks.add_task(  # ‚Üê –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
                notify_event_invited_async,  # –§—É–Ω–∫—Ü–∏—è –∏–∑ notifications_async.py
                user_id=participant_id,
                event_id=event.id,
                inviter_name=inviter_name,
            )
```

### –ü—Ä–∏–º–µ—Ä 2: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

```python
# backend/app/services/notifications_async.py:41-64
def notify_event_invited_async(user_id, event_id, inviter_name):
    try:
        # –°–æ–∑–¥–∞–µ–º –ù–û–í–£–Æ —Å–µ—Å—Å–∏—é –ë–î
        with Session(engine) as session:
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
            event = session.get(Event, event_id)
            if not event:
                logger.warning(f"Event {event_id} not found")
                return
            
            # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            _create_notification_in_background(
                user_id=user_id,
                type="event_invited",
                title="–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É",
                message=f"–í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É ¬´{event.title}¬ª",
                event_id=event_id,
            )
    except Exception as e:
        logger.error(f"Error: {e}", exc_info=True)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –°–µ—Å—Å–∏–∏ –ë–î
- ‚úÖ –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ—é —Å–µ—Å—Å–∏—é
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è connection pooling (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚úÖ –°–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚ö†Ô∏è –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
- ‚ö†Ô∏è –ù–µ—Ç –æ–±—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### 3. –û—à–∏–±–∫–∏
- ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
- ‚úÖ –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏

### 4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –£–ª—É—á—à–∞–µ—Ç –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
- ‚ö†Ô∏è –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- ‚ö†Ô∏è –î–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –Ω—É–∂–µ–Ω Celery

---

## üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)

### Celery (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á)

–ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
- Retry –º–µ—Ö–∞–Ω–∏–∑–º
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á

**–ü—Ä–∏–º–µ—Ä:**
```python
from celery import Celery

celery_app = Celery('tasks', broker='redis://localhost:6379')

@celery_app.task
def notify_event_invited_celery(user_id, event_id):
    # –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –≤–æ—Ä–∫–µ—Ä–µ
    ...
```

---

## üìù –†–µ–∑—é–º–µ

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. Endpoint –ø–æ–ª—É—á–∞–µ—Ç `BackgroundTasks` –æ—Ç FastAPI
2. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ `background_tasks.add_task()`
3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É **—Å—Ä–∞–∑—É**
4. FastAPI –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ **–ø–æ—Å–ª–µ** –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
5. –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ—é —Å–µ—Å—Å–∏—é –ë–î

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫ API
- üöÄ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –û—à–∏–±–∫–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
- üìä –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 50-60%

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥–µ—Ç)
- –î–ª—è –¥–æ–ª–≥–∏—Ö –∑–∞–¥–∞—á –Ω—É–∂–µ–Ω Celery


