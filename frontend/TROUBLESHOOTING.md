# Устранение проблем с DELETE запросами

## Проблема: "Failed to fetch" при удалении уведомлений

### Диагностика:

1. **Откройте DevTools (F12) → Network tab**
   - Попробуйте удалить уведомление
   - Найдите DELETE запрос в списке
   - Проверьте:
     - Отправляется ли запрос (статус должен быть виден)
     - Есть ли OPTIONS запрос перед DELETE (preflight)
     - Какой статус у OPTIONS запроса (должен быть 200)
     - Есть ли ошибки CORS (красный цвет)

2. **Проверьте консоль браузера**
   - Должны быть логи `[API] DELETE ...` с деталями запроса
   - Проверьте URL запроса

3. **Проверьте порт Next.js**
   - Посмотрите в адресной строке браузера, на каком порту работает Next.js
   - Обычно это `http://localhost:3000` или `http://localhost:3001`

### Решение:

#### Вариант 1: Обновить CORS настройки backend

Если Next.js работает не на порту 3000, обновите `backend/app/core/config.py`:

```python
BACKEND_CORS_ORIGINS: List[str] = [
    "http://localhost:3000",
    "http://localhost:3001",  # Добавьте свой порт
    "http://127.0.0.1:3000",
    "http://127.0.0.1:3001",
]
```

**После изменения перезапустите backend!**

#### Вариант 2: Проверить, что backend запущен

```powershell
# Проверьте health endpoint
Invoke-WebRequest -Uri "http://localhost:8000/api/v1/health"
```

#### Вариант 3: Временное решение - использовать PATCH вместо DELETE

Если проблема с CORS не решается, можно временно использовать "мягкое удаление" через PATCH запрос (установка флага `is_read: true` и скрытие уведомления на фронтенде).

### Что уже исправлено:

- ✅ Упрощена конфигурация fetch для DELETE запросов
- ✅ Убраны лишние заголовки, которые могут вызывать preflight
- ✅ Добавлено детальное логирование для диагностики
- ✅ Улучшены сообщения об ошибках

### Если проблема сохраняется:

1. Проверьте логи backend - должны быть видны OPTIONS и DELETE запросы
2. Проверьте Network tab - должен быть виден OPTIONS запрос перед DELETE
3. Убедитесь, что backend перезапущен после изменения CORS настроек

